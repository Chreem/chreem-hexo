---
title: game2048
date: 2017-11-13 14:52:35
categories: games
tags: vue
---
# 最最简单的2048小游戏

和扫雷相比, 这次的编码水平应该进步了...吧

问题也不少:

* 喜闻乐见的深度监视与视图改变
* 生成数字的方式改变(相比问题更应该叫改动)
* 计算逻辑
* [依然未解决]动画

今后可能添加:

* replay
* ...

![2048](/images/game2048.png)

<!-- more -->

## 计算逻辑

这个部分, 当做大头来说可真太浪费了, 代码连注释也就不到30行

1. 先按照移动方向分各个行列数组, 计算逻辑按数组依次进行
2. 堆栈暂存计算结果, 通过游标判断该入栈还是相加, 步骤:

    ```md
    计算:
    遍历第一步传入的数组
    元素为0则continue
    堆栈游标对应位置undefined则该元素入栈
    对应位置与本次数字相等则*=2, 记录计算结果作为得分, 游标++
    否则元素入栈, 且游标指向该元素(游标++)

    调整:
    完成遍历后根据源数组长度在堆栈前补全0
    堆栈元素依次出栈即为计算结果

    返回值:
    结果
    得分
    结果与传入数组不等则未移动任何元素(用于判断是否该生成新数字)
    ```

3. 完全没怀疑自己计算逻辑有问题才导致动画难做

## 拆分功能模块

此前把所有逻辑都写在.vue里导致vue臃肿, 曾经尝试写一个vue对象构造器来分离各部分代码而不是塞在一个Obj里, 但随后不了了之...

## 遇到的问题

本部分详情都已在issue中:

1. [深度监视](https://github.com/Chreem/chreem-site/issues/26)
2. 动画, 显然在计算逻辑上有问题才导致动画一筹莫展, 果然Vue这样的数据驱动型不适合dom操作呀(滑稽, 

## 可能增加的功能

正因为游戏逻辑抽出默认属性从而使之能进行更大棋盘(如5*5, 6*6等)的游戏  
出现4的概率作为参数可选, 以调整难度  
此外生成数字也可以稍作修改达到在`指定位置生成对应数字`的效果, 配合记录本局点出现的位置及移动方向, 从而作为replay的基础

所以可能的功能:

1. replay
2. 重播中途觉得本步不妥可接着当前位置继续

    但要撤回至上一步则只靠点和方向无法还原, 似乎只能记下每次移动后全盘的情况, 额外开销略大, 所以本功能犹豫不决, 即使真要做也只会复原有限步而不会全盘记录(众: 就是不想做, 我: puchi!)

3. 游戏范围调整, 4*4不满足还可以更高
